<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jbp.service.dao.agent.UserInvitationFlowDao">
    <resultMap id="UserInvitationFlowType" type="com.jbp.common.model.agent.UserInvitationFlow">
        <id column="id" property="id"/>
        <result column="uId" property="uId"/>
        <result column="pId" property="pId"/>
        <result column="level" property="level"/>
        <result column="capaId" property="capaId"/>
        <result column="xs_capa_id" property="capaXsId"/>
        <result column="gmt_created" property="gmtCreated"/>
        <result column="gmt_modify" property="gmtModify"/>
        <result column="u_capa_xs_name" property="uCapaXsName"/>
    </resultMap>

    <select id="getUnderCapaList" resultMap="UserInvitationFlowType">
        select f.*, c.capa_id  from eb_user_invitation_flow f
        left join eb_user_capa c on f.uId = c.uid
        where f.pId = #{pId} and c.capa_id >= #{minCapaId}
    </select>

    <select id="getUnderXsCapaList" resultMap="UserInvitationFlowType">
        select f.*, c.capa_id as xs_capa_id  ,x.name  as u_capa_xs_name from eb_user_invitation_flow f
        left join eb_user_capa_xs c on f.uId = c.uid
        left join eb_capa_xs x on x.id = c.capa_id
        where f.pId = #{pId} and c.capa_id >= #{minXsCapaId}
    </select>
</mapper>
